(function(){"use strict";var t="undefined"!=typeof window?window:global;if("function"!=typeof t.require){var e={},n={},i=function(t,e){return{}.hasOwnProperty.call(t,e)},o=function(t,e){var n,i,o=[];n=/^\.\.?(\/|$)/.test(e)?[t,e].join("/").split("/"):e.split("/");for(var s=0,r=n.length;r>s;s++)i=n[s],".."===i?o.pop():"."!==i&&""!==i&&o.push(i);return o.join("/")},s=function(t){return t.split("/").slice(0,-1).join("/")},r=function(e){return function(n){var i=s(e),r=o(i,n);return t.require(r,e)}},a=function(t,e){var i={id:t,exports:{}};return n[t]=i,e(i.exports,r(t),i),i.exports},l=function(t,s){var r=o(t,".");if(null==s&&(s="/"),i(n,r))return n[r].exports;if(i(e,r))return a(r,e[r]);var l=o(r,"./index");if(i(n,l))return n[l].exports;if(i(e,l))return a(l,e[l]);throw Error('Cannot find module "'+t+'" from '+'"'+s+'"')},c=function(t,n){if("object"==typeof t)for(var o in t)i(t,o)&&(e[o]=t[o]);else e[t]=n},u=function(){var t=[];for(var n in e)i(e,n)&&t.push(n);return t};t.require=l,t.require.define=c,t.require.register=c,t.require.list=u,t.require.brunch=!0}})(),require.register("application",function(t,e,n){var i,o,s,r,a,l,c={}.hasOwnProperty,u=function(t,e){function n(){this.constructor=t}for(var i in e)c.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};r=Chaplin.mediator,s=e("core/TILEDMap"),o=e("core/configurationManager"),a=e("routes"),n.exports=i=function(t){function n(){return l=n.__super__.constructor.apply(this,arguments)}return u(n,t),n.prototype.title="shiny wight",n.prototype.initialize=function(){return this.initGameSpecificStuff(),n.__super__.initialize.apply(this,arguments)},n.prototype.initMediator=function(){return r.homepageview=null,r.map=null,r.soundManager=null,r.dialogManager=null,r.mapManager=s,r.configurationManager=o,r.playWithSounds=!0,r.renderDebug=!1,r.disableDialogs=!1,r.factory=e("entities/entities"),r.levels={},r.activeLevel="",r.nextLevel="",r.std=null,r.blockInput=!1,r.gui=null,r.getActiveLevel=function(){return r.levels[r.activeLevel]},n.__super__.initMediator.apply(this,arguments)},n.prototype.initGameSpecificStuff=function(){return function(){var t,e,n;for(t=0,e=["ms","moz","webkit","o"],n=0;e.length>n&&!window.requestAnimationFrame;)window.requestAnimationFrame=window[e[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[n]+"CancelAnimationFrame"]||window[e[n]+"CancelRequestAnimationFrame"],++n;return window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var n,i,o;return n=(new Date).getTime(),o=Math.max(0,16-(n-t)),i=window.setTimeout(function(){return e(n+o)},o),t=n+o,i}),window.cancelAnimationFrame?void 0:window.cancelAnimationFrame=function(t){return clearTimeout(t)}}(),window.debug=document.location.hash.match(/debug/)&&"undefined"!=typeof console&&null!==console,window.Logger=window.console,Object.getPrototypeOf(document.createElement("canvas").getContext("2d")).drawImageTiled=function(t,e,n,i,o,s,r,a,l,c,u){return this.drawImage(t,e*c,n*u,i*c,o*u,s*c,r*u,a*c,l*u)},console._debug=console.debug,console.debug=function(){return debug?console._debug.apply(console,arguments):void 0}},n}(Chaplin.Application)}),require.register("components/Movable",function(t,e,n){var i,o,s,r=function(t,e){return function(){return t.apply(e,arguments)}},a={}.hasOwnProperty,l=function(t,e){function n(){this.constructor=t}for(var i in e)a.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};i=e("core/Component"),s=e("core/Result"),n.exports=o=function(t){function e(){this.moveToPosition=r(this.moveToPosition,this),this.moveOnYAxis=r(this.moveOnYAxis,this),this.moveOnXAxis=r(this.moveOnXAxis,this),this.getActualMoveDistance=r(this.getActualMoveDistance,this),this.stopMovement=r(this.stopMovement,this),this._moveLeft=r(this._moveLeft,this),this._moveRight=r(this._moveRight,this),this._moveUp=r(this._moveUp,this),this._moveDown=r(this._moveDown,this),this.moveLeft=r(this.moveLeft,this),this.moveRight=r(this.moveRight,this),this.moveUp=r(this.moveUp,this),this.moveDown=r(this.moveDown,this),e.__super__.constructor.apply(this,arguments),this.owner.scriptable||console.error("Movable depends on the Scriptable component. %O does not have one",this.owner),this.oldPosition={x:0,y:0},this.moving={up:!1,down:!1,right:!1,left:!1},this.maxDistance=0,this.positionToMoveTo=null,this.onFollow=!1,this.counter=0,this.tryOtherDirection=!1,this.positionCheckTimer=Date.now()}return l(e,t),e.prototype.moveDown=function(t){var e,n=this;return e=Q.defer(),console.assert(t>0,"argument must be a positive integer"),this.owner.scriptable.addTask(function(){return n._moveDown(t,e)}),e.promise},e.prototype.moveUp=function(t){var e,n=this;return e=Q.defer(),console.assert(t>0,"argument must be a positive integer"),this.owner.scriptable.addTask(function(){return n._moveUp(t,e)}),e.promise},e.prototype.moveRight=function(t){var e,n=this;return e=Q.defer(),console.assert(t>0,"argument must be a positive integer"),this.owner.scriptable.addTask(function(){return n._moveRight(t,e)}),e.promise},e.prototype.moveLeft=function(t){var e,n=this;return e=Q.defer(),console.assert(t>0,"argument must be a positive integer"),this.owner.scriptable.addTask(function(){return n._moveLeft(t,e)}),e.promise},e.prototype._moveDown=function(t,e){return this.moving.down?this.owner.position.y>this.targetPos.y?(this.stopMovement(),e.resolve(this),new s(!0)):this.checkPosition&&this.owner.position.y===this.oldPosition.y?(this.stopMovement(),this.tryOtherDirection=!0,e.resolve(this),new s(!0)):(this.owner.physBody.SetLinearVelocity(new this.owner.level.physicsManager.Vec2(0,this.owner.velocity)),new s(!1,this._moveDown,t,e)):(console.debug("Move %O%i down.",this.owner,t),this.targetPos={x:this.owner.position.x,y:this.owner.position.y+t},this.moving.down=!0,this.owner.visual.spriteState.moving=!0,this.owner.visual.spriteState.viewDirection=2,new s(!1,this._moveDown,t,e))},e.prototype._moveUp=function(t,e){return this.moving.up?this.owner.position.y<this.targetPos.y?(this.stopMovement(),e.resolve(this),new s(!0)):this.checkPosition&&this.owner.position.y===this.oldPosition.y?(this.stopMovement(),this.tryOtherDirection=!0,e.resolve(this),new s(!0)):(this.owner.physBody.SetLinearVelocity(new this.owner.level.physicsManager.Vec2(0,-this.owner.velocity)),new s(!1,this._moveUp,t,e)):(console.debug("Move %O%i up.",this.owner,t),this.targetPos={x:this.owner.position.x,y:this.owner.position.y-t},this.moving.up=!0,this.owner.visual.spriteState.moving=!0,this.owner.visual.spriteState.viewDirection=0,new s(!1,this._moveUp,t,e))},e.prototype._moveRight=function(t,e){return this.moving.right?this.owner.position.x>this.targetPos.x?(this.stopMovement(),e.resolve(this),new s(!0)):this.checkPosition&&this.owner.position.x===this.oldPosition.x?(this.stopMovement(),this.tryOtherDirection=!0,e.resolve(this),new s(!0)):(this.owner.physBody.SetLinearVelocity(new this.owner.level.physicsManager.Vec2(this.owner.velocity,0)),new s(!1,this._moveRight,t,e)):(console.debug("Move %O%i right.",this.owner,t),this.targetPos={x:this.owner.position.x+t,y:this.owner.position.y},this.moving.right=!0,this.owner.visual.spriteState.moving=!0,this.owner.visual.spriteState.viewDirection=1,new s(!1,this._moveRight,t,e))},e.prototype._moveLeft=function(t,e){return this.moving.left?this.owner.position.x<this.targetPos.x?(this.stopMovement(),e.resolve(this),new s(!0)):this.checkPosition&&this.owner.position.x===this.oldPosition.x?(this.stopMovement(),this.tryOtherDirection=!0,e.resolve(this),new s(!0)):(this.owner.physBody.SetLinearVelocity(new this.owner.level.physicsManager.Vec2(-this.owner.velocity,0)),new s(!1,this._moveLeft,t,e)):(console.debug("Move %O%i left.",this.owner,t),this.targetPos={x:this.owner.position.x-t,y:this.owner.position.y},this.moving.left=!0,this.owner.visual.spriteState.moving=!0,this.owner.visual.spriteState.viewDirection=3,new s(!1,this._moveLeft,t,e))},e.prototype.stopMovement=function(){return this.owner.physBody.SetLinearVelocity(new this.owner.level.physicsManager.Vec2(0,0)),this.moving.down=!1,this.moving.up=!1,this.moving.left=!1,this.moving.right=!1,this.owner.visual.spriteState.moving=!1},e.prototype.getActualMoveDistance=function(t){return t>this.maxDistance?this.maxDistance:t},e.prototype.moveOnXAxis=function(t,e){var n;return n=this.getActualMoveDistance(t),e>0?this.moveRight(n):this.moveLeft(n)},e.prototype.moveOnYAxis=function(t,e){var n;return n=this.getActualMoveDistance(t),e>0?this.moveDown(n):this.moveUp(n)},e.prototype.moveToPosition=function(t,e){var n=this;return this.positionToMoveTo=t,this.maxDistance=e,this.owner.scriptable.addTask(function(){var t,e,i,o,s,r,a;return n.onFollow||(n.onFollow=!0,n.owner.scriptable.tasks.shift(),n.savedTasks=_.clone(n.owner.scriptable.tasks),n.owner.scriptable.tasks=[]),s=n.owner.velocity/50,3>s&&(s=3),i=Math.floor(n.positionToMoveTo.x-n.owner.position.x),o=Math.floor(n.positionToMoveTo.y-n.owner.position.y),t=Math.abs(i),e=Math.abs(o),n.positionToMoveTo.x-s<(r=n.owner.position.x)&&n.positionToMoveTo.x+s>r&&n.positionToMoveTo.y-s<(a=n.owner.position.y)&&n.positionToMoveTo.y+s>a?(n.owner.position.x=n.positionToMoveTo.x,n.owner.position.y=n.positionToMoveTo.y,n.positionToMoveTo=null,n.onFollow=!1,n.owner.scriptable.tasks=n.savedTasks,void 0):t>=e&&!n.tryOtherDirection?n.moveOnXAxis(t,i):t>=e&&n.tryOtherDirection?(n.tryOtherDirection=!1,n.moveOnYAxis(e,o)):e>=t&&!n.tryOtherDirection?n.moveOnYAxis(e,o):e>=t&&n.tryOtherDirection?(n.tryOtherDirection=!1,n.moveOnXAxis(t,i)):void 0})},e}(i)}),require.register("components/Scriptable",function(t,e,n){var i,o,s,r=function(t,e){return function(){return t.apply(e,arguments)}},a={}.hasOwnProperty,l=function(t,e){function n(){this.constructor=t}for(var i in e)a.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};i=e("core/Component"),o=e("core/Result"),n.exports=s=function(t){function e(){this.addTask=r(this.addTask,this),this._executeScripts=r(this._executeScripts,this),this.addScripts=r(this.addScripts,this),this._scriptable_update=r(this._scriptable_update,this),e.__super__.constructor.apply(this,arguments),this._tasks=[],this.owner.addListener("update",this._scriptable_update)}return l(e,t),e.prototype._scriptable_update=function(){var t,e;return e=this._tasks[0],e&&(t=e(),console.assert(t instanceof o,"Task did not return Result object"),null!=t.done&&(this._tasks.shift(),null!=t.next))?this._tasks.unshift(function(){return t.next.apply(null,t.arguments)}):void 0},e.prototype.addScripts=function(t){var e;return e=Q.defer(),this._executeScripts(t,e),e.promise},e.prototype._executeScripts=function(t,e){var n,i,o,s,r,a=this;if(0===t.length)return e.resolve();if(r=t.shift(),r instanceof Array){if(r[0]instanceof Array)return o=function(){var t,e,n;for(n=[],t=0,e=r.length;e>t;t++)s=r[t],n.push(this.addScripts(s));return n}.call(this),i=Q.all(o),i.then(function(){return console.debug(arguments),a._executeScripts(t,e)});if(r[0]instanceof Function)return n=r.slice(1),i=r[0].apply(null,n),i.then(function(){return console.debug(arguments),a._executeScripts(t,e)})}else if(r instanceof Function)return i=r.apply(),i.then(function(){return console.debug(arguments),a._executeScripts(t,e)})},e.prototype.addTask=function(t){return this._tasks.push(t)},e}(i)}),require.register("components/Visual",function(t,e,n){var i,o,s=function(t,e){return function(){return t.apply(e,arguments)}},r={}.hasOwnProperty,a=function(t,e){function n(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};i=e("core/Component"),n.exports=o=function(t){function e(){this.render=s(this.render,this),this.getSpritePacket=s(this.getSpritePacket,this),e.__super__.constructor.apply(this,arguments),this.spriteState={moving:!1,viewDirection:0,animationRate:100,normal:1},this.atlas=new Image,this.tileSet={tilesX:0,tilesY:0,tileheight:0,tilewidth:0,offset:{x:0,y:0}}}return a(e,t),e.prototype.getSpritePacket=function(){var t,e,n;return e=Math.floor((Date.now()-this.owner.creationTime)/this.spriteState.animationRate)%this.tileSet.tilesX,n=this.spriteState.viewDirection,this.spriteState.moving||(e=this.spriteState.normal),t={x:e*this.tileSet.tilewidth,y:n*this.tileSet.tileheight}},e.prototype.render=function(t,e,n){var i,o,s,r,a,l,c,u,h;return l=this.getSpritePacket(),u=l.x,h=l.y,c=this.tileSet.tilewidth,a=this.tileSet.tileheight,s=this.owner.position.x-e,r=this.owner.position.y-n,o=this.owner.size.x,i=this.owner.size.y,s-=this.tileSet.offset.x,r-=this.tileSet.offset.y,t.drawImage(this.atlas,u,h,c,a,s,r,o,i)},e}(i)}),require.register("controllers/base/controller",function(t,e,n){var i,o,s={}.hasOwnProperty,r=function(t,e){function n(){this.constructor=t}for(var i in e)s.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n.exports=i=function(t){function e(){return o=e.__super__.constructor.apply(this,arguments)}return r(e,t),e}(Chaplin.Controller)}),require.register("controllers/home-controller",function(t,e,n){var i,o,s,r,a={}.hasOwnProperty,l=function(t,e){function n(){this.constructor=t}for(var i in e)a.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};i=e("controllers/base/controller"),s=e("views/home-page-view"),n.exports=o=function(t){function e(){return r=e.__super__.constructor.apply(this,arguments)}return l(e,t),e.prototype.index=function(){return this.view=new s({gMap:this.gMap})},e}(i)}),require.register("core/AssetManager",function(t,e,n){var i,o=function(t,e){return function(){return t.apply(e,arguments)}};n.exports=i=function(){function t(){this.get=o(this.get,this)}var e,n;return n=new createjs.LoadQueue,e=[],t.prototype.get=function(){},t}()}),require.register("core/Component",function(t,e,n){var i,o=function(t,e){return function(){return t.apply(e,arguments)}};n.exports=i=function(){function t(t){this.owner=t,this.mount=o(this.mount,this)}return t.prototype.mount=function(){var t,e,n=this;e=[];for(t in this)"_"!==t[0]&&"owner"!==t&&"constructor"!==t&&"mount"!==t&&(null==this.owner[t]?e.push(this.owner[t]=function(t){return function(){return n[t].apply(n,arguments)}}(t)):console.debug("Method %s exists already and will not be mounted on %O",t,this.owner));return e},t}()}),require.register("core/Core",function(){}),require.register("core/DialogManager",function(t,e,n){var i,o,s=function(t,e){return function(){return t.apply(e,arguments)}};o=Chaplin.mediator,n.exports=i=function(){function t(){this.unblockInput=s(this.unblockInput,this),this.blockInput=s(this.blockInput,this),this.hideDialog=s(this.hideDialog,this),this.showDialog=s(this.showDialog,this),this.isDialog=s(this.isDialog,this),this._chooseCurrentSelection=s(this._chooseCurrentSelection,this),this._selectOption=s(this._selectOption,this),this.moveSelectionUp=s(this.moveSelectionUp,this),this.moveSelectionDown=s(this.moveSelectionDown,this),this.source=document.getElementById("dialog-template"),this.template=Handlebars.compile(this.source.innerText),this.canvas=document.getElementById("game-canvas"),this.$dialog=$("#dialog"),this.currentSelection=1,o.dialogManager=this,this.didIBlock=!1,this.selectOption=_.debounce(this._selectOption,50,!0),this.chooseCurrentSelection=_.debounce(this._chooseCurrentSelection,50,!0)}return t.prototype.moveSelectionDown=function(){return this.selectOption(this.currentSelection+1)},t.prototype.moveSelectionUp=function(){return this.selectOption(this.currentSelection-1)},t.prototype._selectOption=function(t){var e;return e=this.$dialog.children().children(),1>t&&(t=e.length-1),t=(t-1)%(e.length-1)+1,e.removeClass("dialog-option-hovered"),e.eq(t).addClass("dialog-option-hovered"),this.currentSelection=t},t.prototype._chooseCurrentSelection=function(){return this.$dialog.children().children().eq(this.currentSelection).click()},t.prototype.isDialog=function(){return 0!==this.$dialog.children().length},t.prototype.showDialog=function(t){var e,n,i=this;return e=Q.defer(),o.disableDialogs?(e.resolve(),void 0):this.isDialog()?(console.error("I'm already showing a dialog, so you must be doing something wrong!"),e.reject(),void 0):(this.blockInput(),n=$(this.template(t)),console.debug("Show dialog: %O",t),n.children(".dialog-option").click(function(){var t;return t=parseInt($(i).prop("id"))+1,isNaN(t)&&(t=-1),i.hideDialog(),e.resolve(t)}),$("#dialog").append(n).css("left",0).css("top",this.canvas.height+2).css("width",this.canvas.width).fadeIn(),this.selectOption(1),e.promise)},t.prototype.hideDialog=function(){var t;return t=Q.defer(),$("#dialog").empty(),this.unblockInput(),t.resolve(),t.promise},t.prototype.blockInput=function(){return this.didIBlock=o.blockInput?!1:!0,o.blockInput=!0},t.prototype.unblockInput=function(){return this.didIBlock?(o.blockInput=!1,this.didIBlock=!1):void 0},t}()}),require.register("core/Entity",function(t,e,n){var i,o,s,r,a=function(t,e){return function(){return t.apply(e,arguments)}},l={}.hasOwnProperty,c=function(t,e){function n(){this.constructor=t}for(var i in e)l.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=e("core/Module"),r=Chaplin.mediator,s=e("core/Result"),n.exports=i=function(t){function e(t,n){this.unblockInput=a(this.unblockInput,this),this.blockInput=a(this.blockInput,this),this.update=a(this.update,this),this.makeMeDynamic=a(this.makeMeDynamic,this),this.makeMeStatic=a(this.makeMeStatic,this),this.onPositionChange=a(this.onPositionChange,this),this.kill=a(this.kill,this),this.load=a(this.load,this),this.onAction=a(this.onAction,this),this.removeListener=a(this.removeListener,this),this.fire=a(this.fire,this),this.addOneTimeListener=a(this.addOneTimeListener,this),this.addListener=a(this.addListener,this);var i,o,s,r,l,c;e.__super__.constructor.apply(this,arguments),this._listeners=[],s=n.properties;for(o in s)i=s[o],this[o]=i;this.level=t,this.creationTime=Date.now(),this.name=n.name,this.velocity=400,this.position={x:Math.floor(n.x),y:Math.floor(n.y)},this.size={x:Math.floor(n.width),y:Math.floor(n.height)},this.entityDef={type:"dynamic",x:this.position.x,y:this.position.y,width:this.size.x,height:this.size.y,ellipse:!1,isSensor:!1,userData:{ent:this}},this.entityDef.ellipse=null!=(r=n.ellipse)?r:!1,this.entityDef.isSensor=null!=(l=n.properties.isSensor)?l:!1,this.entityDef.type=null!=(c=n.properties.physicsType)?c:"dynamic",this.physBody=this.level.physicsManager.addBody(this.entityDef,this.level.b2World),this.physBody.SetLinearVelocity(new this.level.physicsManager.Vec2(0,0))}return c(e,t),e.prototype.addListener=function(t,e){return null==this._listeners[t]&&(this._listeners[t]=[]),this._listeners[t].push(e)},e.prototype.addOneTimeListener=function(t,e){var n=this;return this.addListener(t,function(t){return n.removeListener(t.type,t.listener),e.call(n,t)})},e.prototype.fire=function(t){var e,n,i,o,s,r,a,l,c;if("string"==typeof t&&(t={type:t}),null==t.target&&(t.target=this),!t.type)throw Error("Event object missing 'type' property.");if(this._listeners[t.type]instanceof Array){for(o=this._listeners[t.type],n=[],s=0,a=o.length;a>s;s++)i=o[s],n.push(i);for(c=[],r=0,l=n.length;l>r;r++)e=n[r],t.listener=e,e.call(this,t),c.push(delete t.callback);return c}},e.prototype.removeListener=function(t,e){var n,i,o,s,r,a;if(this._listeners[t]instanceof Array){for(o=this._listeners[t],a=[],n=s=0,r=o.length;r>s;n=++s){if(i=o[n],i===e){o.splice(n,1);break}a.push(void 0)}return a}},e.prototype.onAction=function(){},e.prototype.load=function(){return this.fire("load")},e.prototype.kill=function(){var t;return t=Q.defer(),this.fire("kill"),this.level.physicsManager.world.DestroyBody(this.physBody),this.level.removeEntity(this),t.resolve(),console.debug("Killed %O",this),t.promise},e.prototype.onPositionChange=function(){},e.prototype.makeMeStatic=function(){return this.oldVelocity=_.clone(this.physBody.GetLinearVelocity()),this.physBody.SetType(Box2D.Dynamics.b2Body.b2_staticBody)},e.prototype.makeMeDynamic=function(){return this.physBody.SetType(Box2D.Dynamics.b2Body.b2_dynamicBody),this.physBody.SetAwake(!0),this.physBody.SetLinearVelocity(this.oldVelocity)},e.prototype.update=function(){return null!=this.physBody.GetPosition().x&&(this.position.x=this.physBody.GetPosition().x),null!=this.physBody.GetPosition().y&&(this.position.y=this.physBody.GetPosition().y),this.fire("update")},e.prototype.blockInput=function(){var t;return t=Q.defer(),this.scriptable.addTask(function(t){return function(){return r.blockInput=!0,t.resolve(),new s(!0)}}(t)),t.promise},e.prototype.unblockInput=function(){var t;return t=Q.defer(),this.scriptable.addTask(function(t){return function(){return r.blockInput=!1,t.resolve(),new s(!0)}}(t)),t.promise},e}(o)}),require.register("core/InputManager",function(t,e,n){var i,o,s,r=function(t,e){return function(){return t.apply(e,arguments)}},a={}.hasOwnProperty,l=function(t,e){function n(){this.constructor=t}for(var i in e)a.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=e("models/base/model"),n.exports=i=function(t){function e(){return this.bind=r(this.bind,this),this.onKeyUpEvent=r(this.onKeyUpEvent,this),this.onKeyDownEvent=r(this.onKeyDownEvent,this),this.initialize=r(this.initialize,this),s=e.__super__.constructor.apply(this,arguments)}return l(e,t),e.prototype.defaults={bindings:{},actions:{},presses:{},locks:{},delayedKeyup:[],keyCodes:{a:65,w:87,d:68,s:83,arrowLeft:37,arrowUp:38,arrowRight:39,arrowDown:40,enter:13,escape:27,space:32}},e.prototype.initialize=function(){var t;return t=this.get("keyCodes"),this.bind(t.w,"move-up"),this.bind(t.a,"move-left"),this.bind(t.s,"move-down"),this.bind(t.d,"move-right"),this.bind(t.arrowUp,"move-up"),this.bind(t.arrowLeft,"move-left"),this.bind(t.arrowDown,"move-down"),this.bind(t.arrowRight,"move-right"),this.bind(t.enter,"interact"),this.bind(t.space,"interact"),this.bind(t.escape,"cancel"),window.addEventListener("keydown",this.onKeyDownEvent),window.addEventListener("keyup",this.onKeyUpEvent),this.otherKeyPressed=!1},e.prototype.onKeyDownEvent=function(t){var e,n,i,o;return o=t.keyCode,this.otherKeyPressed&&this.onKeyUpEvent(this.otherKeyPressed),i=this.get("bindings"),n=this.get("actions"),e=i[o],e&&(n[e]=!0),this.set({actions:n}),this.otherKeyPressed=t},e.prototype.onKeyUpEvent=function(t){var e,n,i,o;return i=this.get("bindings"),n=this.get("actions"),o=t.keyCode,e=i[o],e&&(n[e]=!1),this.set({actions:n})},e.prototype.bind=function(t,e){var n;return n=this.get("bindings"),n[t]=e},e}(o)}),require.register("core/Level",function(t,e,n){var i,o,s,r,a=function(t,e){return function(){return t.apply(e,arguments)}},l={}.hasOwnProperty,c=function(t,e){function n(){this.constructor=t}for(var i in e)l.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=e("models/base/model"),s=e("core/PhysicsManager"),r=Chaplin.mediator,n.exports=i=function(t){function e(t,e){var n=this;this._callback=e,this.addTask=a(this.addTask,this),this.updatePhysics=a(this.updatePhysics,this),this.update=a(this.update,this),this.createEntity=a(this.createEntity,this),this.removeEntity=a(this.removeEntity,this),this.addEntity=a(this.addEntity,this),this.initialSpawn=a(this.initialSpawn,this),this.checkIfDone=a(this.checkIfDone,this),this.setup=a(this.setup,this),this.manifest=null,this._tasks=[],this.mapSoundList={},this.backgroundSoundList={},this.soundTheme=null,this.soundCount=0,this.physicsManager,this.entities={},this.entityObjects=[],this.player=null,this.bodyCount=0,this.mapCanvas=null,this.mapTiledObject=null,this.tileSets=null,this.bodiesLoaded=!1,this.mapLoaded=!1,this.loadCompleted=!1,this.setupped=!1,this.soundsLoaded=!1,this.manifest=r.configurationManager.configure({},t),r.std.xhrGet(this.manifest.map.prefix+"/"+this.manifest.map.file,function(t){return n.mapTiledObject=JSON.parse(t.target.responseText),r.mapManager.parse(n.mapTiledObject,function(t,e){return n.mapCanvas=t,n.tileSets=e,n.mapTiledObject.processedTileSets=n.tileSets,n.mapLoaded=!0,n.physicsManager=new s(n.mapTiledObject),n.checkIfDone()}),r.playWithSounds?(n.soundMap=r.soundManager.getSoundMap(n.mapTiledObject),n.mapSoundList=n.manifest.sounds.sounds,n.backgroundSoundList=n.manifest.sounds.backgroundSounds,n.themeSound=n.manifest.sounds.theme,n.themeIntensity=null!=n.manifest.sounds.themeIntensity?n.manifest.sounds.themeIntensity:1,n.soundCount=n.mapSoundList.length+n.backgroundSoundList.length+1,r.soundManager.loadSounds(n.manifest.sounds,function(){return n.soundCount--,0>=n.soundCount?(n.soundsLoaded=!0,n.checkIfDone()):void 0})):void 0})}return c(e,t),e.prototype.setup=function(){return this.loadCompleted?this.setupped?console.error("Level already set up!"):(this.setupped=!0,this.initialSpawn()):console.error("Don't call Level.setup() unless the manifest finished loading!")},e.prototype.checkIfDone=function(){return this.mapLoaded&&(this.soundsLoaded||!r.playWithSounds)&&(console.debug("Finished loading Map: %O",this.manifest.map),this.loadCompleted=!0,this._callback)?this._callback():void 0},e.prototype.initialSpawn=function(){var t,e,n,i,o,s,r;for(s=this.mapTiledObject.layers,r=[],i=0,o=s.length;o>i;i++)t=s[i],"tilelayer"!==t.type&&"spawnpoints"===t.name&&r.push(function(){var i,o,s,r;for(s=t.objects,r=[],i=0,o=s.length;o>i;i++)n=s[i],""!==n.type&&(e=this.addEntity(n),"Player"===n.type?r.push(this.player=e):r.push(void 0));return r}.call(this));return r},e.prototype.addEntity=function(t){var e;return e=this.createEntity(t),this.entityObjects.push(e),e},e.prototype.removeEntity=function(t){return this._tasks.push(function(){var e;return e=this.entityObjects.indexOf(t),this.entityObjects.splice(e,1)})},e.prototype.createEntity=function(t){var e,n,i;return e=r.factory[t.type],n=r.configurationManager[t.name],null==n&&console.warn("No configurations found for %s:%O",t.name,t),i=new e(this,_.clone(t)),n&&n.apply(i),i.load(),i},e.prototype.update=function(){var t,e,n,i,o,s,r,a,l;for(a=this.entityObjects,i=0,s=a.length;s>i;i++)t=a[i],t.update();for(l=this._tasks,e=o=0,r=l.length;r>o;e=++o)n=l[e],n.apply(this);return this._tasks=[]},e.prototype.updatePhysics=function(){return this.physicsManager.update()},e.prototype.addTask=function(t){return this._tasks.push(function(){return t.apply(this)})},e}(o)}),require.register("core/Module",function(t,e,n){var i,o,s=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};o=["extended","included"],n.exports=i=function(){function t(){}return t.extend=function(t){var e,n,i;for(e in t)n=t[e],0>s.call(o,e)&&(this[e]=n);return null!=(i=t.extended)&&i.apply(this),this},t.include=function(t){var e,n,i;for(e in t)n=t[e],0>s.call(o,e)&&(this.prototype[e]=n);return null!=(i=t.included)&&i.apply(this),this},t}()}),require.register("core/PhysicsManager",function(t,e,n){var i,o,s,r,a,l,c,u,h,p,m,f,d,y,_,g=function(t,e){return function(){return t.apply(e,arguments)}};u=e("models/base/model"),_=Chaplin.mediator,d=Box2D.Common.Math.b2Vec2,o=Box2D.Dynamics.b2BodyDef,i=Box2D.Dynamics.b2Body,l=Box2D.Dynamics.b2FixtureDef,a=Box2D.Dynamics.b2Fixture,y=Box2D.Dynamics.b2World,c=Box2D.Collision.Shapes.b2MassData,m=Box2D.Collision.Shapes.b2PolygonShape,s=Box2D.Collision.Shapes.b2CircleShape,r=Box2D.Dynamics.b2DebugDraw,f=Box2D.Dynamics.Joints.b2RevoluteJointDef,h=1/60,n.exports=p=function(){function t(t){var e,n,i;this.map=t,this.removeBody=g(this.removeBody,this),this.addBody=g(this.addBody,this),this.registerBody=g(this.registerBody,this),this.addContactListener=g(this.addContactListener,this),this.update=g(this.update,this),this.createLevelBorder=g(this.createLevelBorder,this),this.createStaticBodyWithPolygon=g(this.createStaticBodyWithPolygon,this),this.createStaticBodyWithBox=g(this.createStaticBodyWithBox,this),this.addBackgroundRigidBodies=g(this.addBackgroundRigidBodies,this),this.world=new y(new d(0,0),!1),i=new Box2D.Dynamics.b2DebugDraw,e=document.getElementById("debug-canvas"),n=e.getContext("2d"),this.createLevelBorder(this.map),e.width=window.innerWidth/2-100,e.height=window.innerHeight-100,i.SetSprite(n),i.SetDrawScale(.5),i.SetFillAlpha(.3),i.SetLineThickness(1),i.SetFlags(Box2D.Dynamics.b2DebugDraw.e_shapeBit|Box2D.Dynamics.b2DebugDraw.e_jointBit),this.world.SetDebugDraw(i),this.addBackgroundRigidBodies(this.map),this.addContactListener()}return t.prototype.world=null,t.prototype.Vec2=Box2D.Common.Math.b2Vec2,t.prototype.BodyDef=Box2D.Dynamics.b2BodyDef,t.prototype.Body=Box2D.Dynamics.b2Body,t.prototype.FixtureDef=Box2D.Dynamics.b2FixtureDef,t.prototype.Fixture=Box2D.Dynamics.b2Fixture,t.prototype.World=Box2D.Dynamics.b2World,t.prototype.MassData=Box2D.Collision.Shapes.b2MassData,t.prototype.PolygonShape=Box2D.Collision.Shapes.b2PolygonShape,t.prototype.CircleShape=Box2D.Collision.Shapes.b2CircleShape,t.prototype.DebugDraw=Box2D.Dynamics.b2DebugDraw,t.prototype.RevoluteJointDef=Box2D.Dynamics.Joints.b2RevoluteJointDef,t.prototype.addBackgroundRigidBodies=function(){var t,e,n,i,o,s,r,a,l,c,u,h,p,m,f;for(m=this.map.layers,f=[],h=0,p=m.length;p>h;h++)t=m[h],"physics"===t.name&&("objectgroup"===t.type?f.push(function(){var n,i,o,s;for(o=t.objects,s=[],n=0,i=o.length;i>n;n++)e=o[n],e.polygon?(l=function(){var t,n,i,o;for(i=e.polygon,o=[],t=0,n=i.length;n>t;t++)a=i[t],o.push(new d(a.x,a.y));return o}(),s.push(this.createStaticBodyWithPolygon(l,e.x,e.y))):s.push(this.createStaticBodyWithBox(e.x,e.y,e.width,e.height));return s}.call(this)):"tilelayer"===t.type?f.push(function(){var e,a,h,p;for(h=t.data,p=[],s=e=0,a=h.length;a>e;s=++e)o=h[s],0!==o&&(c=s%this.map.width*this.map.tilewidth,u=Math.floor(s/this.map.width)*this.map.tileheight,i=_.mapManager.getTilePacket(o,this.map.processedTileSets),n=i.px/this.map.tilewidth,r=this.map.tilewidth,0===n?p.push(this.createStaticBodyWithBox(c,u,r,r)):1===n?(l=[new d(0,r),new d(r,0),new d(r,r)],p.push(this.createStaticBodyWithPolygon(l,c,u))):2===n?(l=[new d(0,0),new d(r,r),new d(0,r)],p.push(this.createStaticBodyWithPolygon(l,c,u))):3===n?(l=[new d(0,0),new d(r,0),new d(r,r)],p.push(this.createStaticBodyWithPolygon(l,c,u))):4===n?(l=[new d(0,0),new d(r,0),new d(0,r)],p.push(this.createStaticBodyWithPolygon(l,c,u))):p.push(void 0));return p}.call(this)):f.push(void 0));return f},t.prototype.createStaticBodyWithBox=function(t,e,n,s){var r,a,c;return c=new l,c.shape=new m,c.shape.SetAsBox(n/2,s/2),r=new o,r.type=i.b2_staticBody,r.position.x=t+n/2,r.position.y=e+s/2,a=this.registerBody(r),a.CreateFixture(c)},t.prototype.createStaticBodyWithPolygon=function(t,e,n){var s,r,a;return a=new l,a.shape=new m,a.shape.SetAsArray(t,t.length),s=new o,s.type=i.b2_staticBody,s.position.x=e,s.position.y=n,r=this.registerBody(s),r.CreateFixture(a)},t.prototype.createLevelBorder=function(){var t,e,n;return e=new l,e.shape=new m,e.shape.SetAsBox(0,this.map.tileheight*this.map.height),n=new o,n.type=i.b2_staticBody,n.position.x=0,n.position.y=0,t=this.registerBody(n,this.world),t.CreateFixture(e),e=new l,e.shape=new m,e.shape.SetAsBox(0,this.map.tileheight*this.map.height),n=new o,n.type=i.b2_staticBody,n.position.x=this.map.tilewidth*this.map.width,n.position.y=0,t=this.registerBody(n,this.world),t.CreateFixture(e),e=new l,e.shape=new m,e.shape.SetAsBox(this.map.tilewidth*this.map.width,0),n=new o,n.type=i.b2_staticBody,n.position.x=0,n.position.y=0,t=this.registerBody(n,this.world),t.CreateFixture(e),e=new l,e.shape=new m,e.shape.SetAsBox(this.map.tilewidth*this.map.width,0),n=new o,n.type=i.b2_staticBody,n.position.x=0,n.position.y=this.map.tileheight*this.map.height,t=this.registerBody(n,this.world),t.CreateFixture(e)},t.prototype.update=function(){return this.world.Step(h,10,10)},t.prototype.addContactListener=function(){var t;return t=new Box2D.Dynamics.b2ContactListener,t.BeginContact=function(t){var e,n,i,o,s,r;return e=t.GetFixtureA().GetBody(),n=t.GetFixtureB().GetBody(),i=e.GetUserData(),o=n.GetUserData(),s={type:"touchBegin",arguments:[n]},r={type:"touchBegin",arguments:[e]},null!=i&&i.ent.fire(s),null!=o?o.ent.fire(r):void 0
},t.EndContact=function(t){var e,n,i,o,s,r;return e=t.GetFixtureA().GetBody(),n=t.GetFixtureB().GetBody(),i=e.GetUserData(),o=n.GetUserData(),s={type:"touchEnd",arguments:[n]},r={type:"touchEnd",arguments:[e]},null!=i&&i.ent.fire(s),null!=o?o.ent.fire(r):void 0},t.PostSolve=function(t,e){var n,i,o,s,r,a;return n=t.GetFixtureA().GetBody(),i=t.GetFixtureB().GetBody(),o=n.GetUserData(),s=i.GetUserData(),e=e.normalImpulses[0],r={type:"touch",arguments:[i,e]},a={type:"touch",arguments:[n,e]},null!=o&&o.ent.fire(r),null!=s?s.ent.fire(a):void 0},this.world.SetContactListener(t)},t.prototype.registerBody=function(t){var e;return e=this.world.CreateBody(t)},t.prototype.addBody=function(t){var e,n,r,a,c;return n=new o,c=Math.floor(t.width/2),a=Math.floor(t.height/2),n.type="static"===t.type?i.b2_staticBody:i.b2_dynamicBody,n.position.x=t.x+c,n.position.y=t.y+a,t.userData&&(n.userData=t.userData),e=this.registerBody(n),r=new l,t.isSensor&&(r.isSensor=!0),t.ellipse?(r.shape=new s,r.shape.SetRadius(c)):(r.shape=new m,r.shape.SetAsBox(c,a)),e.CreateFixture(r),e},t.prototype.removeBody=function(t){return this.world.DestroyBody(t)},t}()}),require.register("core/Result",function(t,e,n){var i,o=[].slice;n.exports=i=function(){function t(){var t,e,n;e=arguments[0],n=arguments[1],t=arguments.length>=3?o.call(arguments,2):[],this.done=e,this.next=n,this.arguments=t}return t.prototype.done=!0,t.prototype.next=null,t.prototype.arguments=null,t}()}),require.register("core/SoundManager",function(t,e,n){var i,o,s,r,a,l=function(t,e){return function(){return t.apply(e,arguments)}},c={}.hasOwnProperty,u=function(t,e){function n(){this.constructor=t}for(var i in e)c.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};i=e("models/base/model"),s=e("core/SoundObj"),r=Chaplin.mediator,n.exports=o=function(t){function e(){return this.startAll=l(this.startAll,this),this.fade=l(this.fade,this),this.updateBackgroundSounds=l(this.updateBackgroundSounds,this),this.startThemeSound=l(this.startThemeSound,this),this.startBackgroundSounds=l(this.startBackgroundSounds,this),this.stopAll=l(this.stopAll,this),this.stop=l(this.stop,this),this.playSound=l(this.playSound,this),this.bufferSounds=l(this.bufferSounds,this),this.loadSounds=l(this.loadSounds,this),this.getSoundMap=l(this.getSoundMap,this),this.initialize=l(this.initialize,this),a=e.__super__.constructor.apply(this,arguments)}return u(e,t),e.prototype.initialize=function(){return e.__super__.initialize.apply(this,arguments),r.soundManager=this,"undefined"!=typeof webkitAudioContext&&null!==webkitAudioContext?this.audioContext=new webkitAudioContext:r.playWithSounds=!1,this.globalSoundList={},this.lastLevelTheme=""},e.prototype.getSoundMap=function(t){var e,n,i,o,s,r,a,l,c,u,h,p,m,f;for(n=[],s=a=0,p=t.width-1;p>=0?p>=a:a>=p;s=p>=0?++a:--a)n[s]=function(){var e,n,i;for(i=[],r=e=0,n=t.height-1;n>=0?n>=e:e>=n;r=n>=0?++e:--e)i.push([]);return i}();for(m=t.layers,l=0,u=m.length;u>l;l++)if(e=m[l],"sound"===e.name)for(f=e.data,o=c=0,h=f.length;h>c;o=++c)i=f[o],0!==i&&(s=o%t.width,r=Math.floor(o/t.width),n[s][r].push(e.properties));return n},e.prototype.loadSounds=function(t,e){var n,i,o,a,l,c,u;for(this.soundCount=t.sounds.length+t.backgroundSounds.length+1,c=t.sounds,i=0,a=c.length;a>i;i++)n=c[i],null==this.globalSoundList[n]?(this.globalSoundList[n]=new s,r.std.xhrGet(t.prefix+n,this.bufferSounds,"arraybuffer",n,e)):e();for(u=t.backgroundSounds,o=0,l=u.length;l>o;o++)n=u[o],null==this.globalSoundList[n]?(this.globalSoundList[n]=new s,r.std.xhrGet(t.prefix+n,this.bufferSounds,"arraybuffer",n,e)):e();return null==this.globalSoundList[t.theme]?(this.globalSoundList[t.theme]=new s,r.std.xhrGet(t.prefix+t.theme,this.bufferSounds,"arraybuffer",t.theme,e)):e()},e.prototype.bufferSounds=function(t){var e,n,i,o,s=this;return i=t.target,o=i.additionalAttributes[0],n=i.additionalAttributes[1],e=this.audioContext.decodeAudioData(i.response,function(t){return s.globalSoundList[o].buffer=t,console.debug("@s loaded",o),"function"==typeof n?n():void 0})},e.prototype.playSound=function(t,e,n){var i;return this.globalSoundList[t].isPlaying!==!0?(i=this.audioContext.createBufferSource(),i.buffer=this.globalSoundList[t].buffer,i.loop=n,i.gain.value=e,i.connect(this.audioContext.destination),this.globalSoundList[t].sourceNode=i,i.start(0),this.globalSoundList[t].isPlaying=!0):this.fade(t,e,0)},e.prototype.stop=function(t){return this.globalSoundList[t].isPlaying?(this.globalSoundList[t].sourceNode.stop(this.audioContext.currentTime),this.globalSoundList[t].isPlaying=!1,console.debug("@s.mp3 stopped",t)):void 0},e.prototype.stopAll=function(t){var e,n,i,o,s,a,l,c,u,h,p;if(i=[],(null!=t?t.themeSound:void 0)?i.push(r.getActiveLevel().themeSound):this.lastLevelTheme=r.getActiveLevel().themeSound,null!=t?t.backgroundSounds:void 0)for(c=r.getActiveLevel().backgroundSoundList,o=0,a=c.length;a>o;o++)n=c[o],i.push(n);if(null!=t?t.sounds:void 0)for(u=r.getActiveLevel().mapSoundList,s=0,l=u.length;l>s;s++)n=u[s],i.push(n);h=this.globalSoundList,p=[];for(e in h)n=h[e],-1!==i.indexOf(e)?p.push(this.stop(e)):p.push(void 0);return p},e.prototype.startBackgroundSounds=function(){var t,e,n,i,o;for(i=r.getActiveLevel().backgroundSoundList,o=[],e=0,n=i.length;n>e;e++)t=i[e],o.push(this.playSound(t,0,!0));return o},e.prototype.startThemeSound=function(){var t,e;return e=r.getActiveLevel().themeSound,t=r.getActiveLevel().themeIntensity,this.lastLevelTheme===e?this.fade(e,t,0):(null!=this.globalSoundList[this.lastLevelTheme]&&this.stop(this.lastLevelTheme),this.playSound(e,t,!0))},e.prototype.updateBackgroundSounds=function(t){var e,n,i,o,s,a,l,c,u;for(this.backgroundSoundsToPlay=[],e=r.getActiveLevel(),l=e.soundMap[Math.floor(t.x/32)][Math.floor(t.y/32)],i=0,s=l.length;s>i;i++)n=l[i],this.fade(n.type+".mp3",n.intensity/100,1),this.backgroundSoundsToPlay.push(n.type+".mp3");for(c=e.backgroundSoundList,u=[],o=0,a=c.length;a>o;o++)n=c[o],-1===this.backgroundSoundsToPlay.indexOf(n)?u.push(this.fade(n,0,1)):u.push(void 0);return u},e.prototype.fade=function(t,e,n){return this.globalSoundList[t].sourceNode.gain.setTargetAtTime(e,this.audioContext.currentTime,n)},e.prototype.startAll=function(){return this.startThemeSound(),this.startBackgroundSounds(),this.updateBackgroundSounds(r.getActiveLevel().player.position)},e}(i)}),require.register("core/SoundObj",function(t,e,n){var i,o,s;i=e("models/base/model"),s=Chaplin.mediator,n.exports=o=function(){function t(){this.sourceNode=null,this.gainNode=null,this.buffer=null,this.isPlaying=!1}return t}()}),require.register("core/TILEDMap",function(t,e,n){var i;n.exports=i=function(){function t(){}return t.parseMapJSON=function(e,n){var i,o,s;return console.debug("Start loading atlasses"),i=e.tilesets.length,s=function(){var t,r,a,l;for(a=e.tilesets,l=[],t=0,r=a.length;r>t;t++)o=a[t],l.push(this.createTileSet(o,function(){return i--,0>=i?n(s):console.debug(""+i+" tile sets to go. Hang in there!")}));return l}.call(t)},t.createTileSet=function(t,e){var n,i;return n=new Image,n.onload=function(){return e()},n.src="gameassets/atlases/"+t.image.replace(/^.*[\\\/]/,""),i={firstgid:t.firstgid,image:n,imageheight:t.imageheight,imagewidth:t.imagewidth,tileheight:t.tileheight,tilewidth:t.tilewidth,name:t.name,numXTiles:Math.floor(t.imagewidth/(t.tilewidth+t.spacing)),numYTiles:Math.floor(t.imageheight/(t.tileheight+t.spacing)),spacing:t.spacing}},t.getTilePacket=function(t,e){var n,i,o,s,r,a;for(s={img:null,px:0,py:0},r=null,a=e.length-1;a>=0&&(r=e[a],!(t>=r.firstgid));a+=-1);return s.img=r.image,o=t-r.firstgid,n=Math.floor(o%r.numXTiles),i=Math.floor(o/r.numXTiles),s.py=i*(r.tileheight+r.spacing)+r.spacing,s.px=n*(r.tilewidth+r.spacing)+r.spacing,s},t.render=function(e,n){var i,o,s,r,a,l,c,u,h,p,m,f,d;for(i=document.createElement("canvas"),s=i.getContext("2d"),i.width=e.width*e.tilewidth,i.height=e.height*e.tileheight,console.debug("Finished loading atlasses"),f=e.layers,u=0,p=f.length;p>u;u++)if(r=f[u],"tilelayer"===r.type&&"sound"!==r.name&&"physics"!==r.name)for(d=r.data,c=h=0,m=d.length;m>h;c=++h)a=d[c],0!==a&&(l=t.getTilePacket(a,n),o={x:c%e.width*e.tilewidth,y:Math.floor(c/e.width)*e.tileheight},s.drawImage(l.img,l.px,l.py,e.tilewidth,e.tileheight,o.x,o.y,e.tilewidth,e.tileheight));return i},t.parse=function(e,n){return t.parseMapJSON(e,function(i){return n(t.render(e,i),i)})},t}.call(this)}),require.register("core/configurationManager",function(t,e,n){var i,o,s;o=Chaplin.mediator,s="gameassets/sounds/",i="gameassets/map",n.exports={configure:function(t,e){return null!=this[e]?this[e].apply(t):console.error("Configuration "+e+" not found!"),t},promisedConfigure:function(t,e){var n;return n=Q.defer(),this.configure(t,e),n.resolve(t),n.promise},level1:function(){return this.sounds={prefix:s,sounds:["jtTheme.mp3"],theme:"level1theme.mp3",backgroundSounds:["water.mp3","fire.mp3","wood.mp3"]},this.map={prefix:i,file:"level1.json"}},level2:function(){return this.sounds={prefix:s,sounds:[],theme:"level2theme.mp3",backgroundSounds:[]},this.map={prefix:i,file:"level2.json"}},level2house1:function(){return this.sounds={prefix:s,sounds:[],theme:"level2theme.mp3",themeIntensity:.3,backgroundSounds:[]},this.map={prefix:i,file:"level2house1.json"}},level2house2:function(){return this.sounds={prefix:s,sounds:[],theme:"level2theme.mp3",themeIntensity:.3,backgroundSounds:[]},this.map={prefix:i,file:"level2house2.json"}},level3:function(){return this.sounds={prefix:s,sounds:[],theme:"underground.mp3",backgroundSounds:[]},this.map={prefix:i,file:"level3.json"}},level4:function(){return this.sounds={prefix:s,sounds:[],theme:"underground.mp3",backgroundSounds:[]},this.map={prefix:i,file:"level4.json"}},level5:function(){return this.sounds={prefix:s,sounds:[],theme:"level2theme.mp3",backgroundSounds:[]},this.map={prefix:i,file:"level5.json"}},level6:function(){return this.sounds={prefix:s,sounds:[],theme:"level2theme.mp3",backgroundSounds:[]},this.map={prefix:i,file:"level6.json"}},level7:function(){return this.sounds={prefix:s,sounds:[],theme:"level2theme.mp3",backgroundSounds:[]},this.map={prefix:i,file:"level7.json"}},Player:function(){return this.velocity=200,this.visual.spriteState.viewDirection=2,this.visual.atlas.src="gameassets/atlases/warrior_m.png",this.visual.tileSet.tilesX=3,this.visual.tileSet.tilesY=4,this.visual.tileSet.tileheight=32,this.visual.tileSet.tilewidth=32,this.visual.tileSet.offset={x:16,y:24}},PlayerSkeleton:function(){return this.velocity=250,this.visual.atlas.src="gameassets/atlases/nick.png",this.visual.tileSet.tilesX=3,this.visual.tileSet.tilesY=4,this.visual.tileSet.tileheight=32,this.visual.tileSet.tilewidth=32,this.visual.tileSet.offset={x:16,y:24}},Mario1:function(){},Mario2:function(){},Mario3:function(){var t;return t=o.dialogManager,this.onAction=function(){var e;return e={speaker:"Mario",text:"Hey there. I love being beaten by this Mushroom-Guy. Please, stay there, stare and do nothing.",options:"Okay. Bye."},t.showDialog(e,function(){return e.text="Are you kidding me? Beat this thing to death. And do it painfully with all your strength. Please.",t.showDialog(e)})}},Gumba:function(){var t=this;return this.hit=5,this.onAction=function(){return 0>t.hit--?t.kill():void 0}},Yeti:function(){return this.velocity=200,this.visual.atlas.src="gameassets/atlases/yetis.png",this.visual.tileSet.tilesX=3,this.visual.tileSet.tilesY=4,this.visual.tileSet.tileheight=32,this.visual.tileSet.tilewidth=32,this.visual.tileSet.offset={x:16,y:24}}}}),require.register("core/std",function(t,e,n){var i,o,s,r,a={}.hasOwnProperty,l=function(t,e){function n(){this.constructor=t}for(var i in e)a.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c=[].slice;i=e("models/base/model"),s=Chaplin.mediator,n.exports=o=function(t){function e(){return r=e.__super__.constructor.apply(this,arguments)}return l(e,t),e.prototype.initialize=function(){return s.std=this},e.prototype.xhrGet=function(){var t,e,n,i,o;return n=arguments[0],e=arguments[1],i=arguments[2],t=arguments.length>=4?c.call(arguments,3):[],o=new XMLHttpRequest,null!=i&&(o.responseType=i),o.additionalAttributes=t,o.open("GET",n,!0),o.onload=e,o.send()},e}(i)}),require.register("entities/Event",function(t,e,n){var i,o,s,r={}.hasOwnProperty,a=function(t,e){function n(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};i=e("core/Entity"),s=e("components/Scriptable"),n.exports=o=function(t){function e(t,n){n.properties.physicsType="static",n.properties.isSensor=!0,e.__super__.constructor.call(this,t,n),this.scriptable=new s(this)}return a(e,t),e}(i)}),require.register("entities/Gumba",function(t,e,n){var i,o,s,r,a=function(t,e){return function(){return t.apply(e,arguments)}},l={}.hasOwnProperty,c=function(t,e){function n(){this.constructor=t}for(var i in e)l.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};i=e("core/Entity"),s=e("components/Visual"),r=Chaplin.mediator,n.exports=o=function(t){function e(t,n){this.update=a(this.update,this);var i;n.properties.physicsType="static",e.__super__.constructor.call(this,t,n),this.visual=i=new s(this),function(t){return t.atlas.src="gameassets/atlases/gumba.png",t.spriteState.viewDirection=2,t.tileSet.tilesX=3,t.tileSet.tilesY=4,t.tileSet.tileheight=32,t.tileSet.tilewidth=32,t.tileSet.offset={x:14,y:24}}(i)}return c(e,t),e.prototype.update=function(){return e.__super__.update.apply(this,arguments)},e}(i)}),require.register("entities/Level1Event1",function(t,e,n){var i,o,s,r,a,l=function(t,e){return function(){return t.apply(e,arguments)}},c={}.hasOwnProperty,u=function(t,e){function n(){this.constructor=t}for(var i in e)c.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};i=e("entities/Event"),r=Chaplin.mediator,a=e("story/level1"),s=e("core/Result"),n.exports=o=function(t){function e(t,n){this._activateYetis2=l(this._activateYetis2,this),this._activateYetis=l(this._activateYetis,this),this._spawnYetis=l(this._spawnYetis,this);var i=this;e.__super__.constructor.call(this,t,n),this.dm=r.dialogManager,this.addOneTimeListener("touchBegin",function(){return i.level.addTask(i._spawnYetis)}),this.addOneTimeListener("touchEnd",this._activateYetis2)}return u(e,t),e.prototype._spawnYetis=function(){var t,e,n;return e=_.clone(n={name:"Yeti",type:"Yeti",x:512,y:16,width:32,height:32,properties:{}}),n.x=544,this.jt=this.level.addEntity(e),this.ss=this.level.addEntity(n),r.playWithSounds&&(r.soundManager.stopAll(t={themeSound:!0,backgroundSounds:!0}),r.soundManager.playSound(this.level.manifest.sounds.sounds[0],1,!0)),new s(!0)},e.prototype._activateYetis=function(t){var e,n=this;return e=t.arguments[0],this.player=e.GetUserData().ent,this.jt=this.jt,this.ss=this.ss,this.dm.hideDialog(),this.jt.blockInput().then(function(){return n.jt.moveDown(150)}).then(function(){return n.jt.moveLeft(60)}).then(function(){return n.dm.showDialog(a[1])}).then(function(){return n.dm.showDialog(a[2])}).then(function(){return Q.all([n.ss.moveDown(150).then(function(){return n.ss.moveLeft(90)}),n.jt.moveDown(90).then(function(){return n.jt.moveLeft(30)})])}).then(function(){return n.dm.showDialog(a[3])}).then(function(){return n.dm.showDialog(a[4])}).then(function(){return n.dm.showDialog(a[5])}).then(function(){return n.dm.showDialog(a[6])}).then(function(){return r.configurationManager.configure(n.player,"PlayerSkeleton"),Q.all([n.jt.moveRight(80).then(function(){return n.jt.moveUp(250)}),n.ss.moveRight(60).then(function(){return n.ss.moveUp(165)})])}).then(function(){return Q.all([n.ss.kill(),n.jt.kill()])}).then(function(){return n.dm.showDialog(a[7])}).then(this.unblockInput)},e.prototype._activateYetis2=function(t){var e,n=this;return e=t.arguments[0],this.player=e.GetUserData().ent,this.jt.addScripts([this.dm.hideDialog,this.jt.blockInput,[this.jt.moveDown,150],[this.jt.moveLeft,60],[this.dm.showDialog,a[1]],[this.dm.showDialog,a[2]],[[[this.ss.moveDown,150],[this.ss.moveLeft,50]],[[this.ss.moveLeft,40]],[[this.jt.moveDown,90],[this.jt.moveLeft,30]]],[this.dm.showDialog,a[3]],[this.dm.showDialog,a[4]],[this.dm.showDialog,a[5]],[this.dm.showDialog,a[6]],function(){return r.configurationManager.promisedConfigure(n.player,"PlayerSkeleton")},[[[this.jt.moveRight,80],[this.jt.moveUp,250]],[[this.ss.moveRight,60],[this.ss.moveUp,165]]],[this.ss.kill],[this.jt.kill],[this.dm.showDialog,a[7]],[this.unblockInput]])},e}(i)}),require.register("entities/Level1NickTalking",function(t,e,n){var i,o,s,r,a=function(t,e){return function(){return t.apply(e,arguments)}},l={}.hasOwnProperty,c=function(t,e){function n(){this.constructor=t}for(var i in e)l.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};i=e("entities/Event"),s=Chaplin.mediator,r=e("story/level1"),n.exports=o=function(t){function e(t,n){this._nickTalks=a(this._nickTalks,this),e.__super__.constructor.call(this,t,n),this.addOneTimeListener("touchEnd",this._nickTalks)}return c(e,t),e.prototype._nickTalks=function(){return s.dialogManager.showDialog(r[9])},e}(i)}),require.register("entities/Level1Prolog",function(t,e,n){var i,o,s,r,a=function(t,e){return function(){return t.apply(e,arguments)}},l={}.hasOwnProperty,c=function(t,e){function n(){this.constructor=t}for(var i in e)l.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};i=e("entities/Event"),s=Chaplin.mediator,r=e("story/level1"),n.exports=o=function(t){function e(t,n){this._showProlog=a(this._showProlog,this),e.__super__.constructor.call(this,t,n),this.addOneTimeListener("touchEnd",this._showProlog)}return c(e,t),e.prototype._showProlog=function(){return s.dialogManager.showDialog(r[8]),s.homepageview.loadLevel("level3")},e}(i)}),require.register("entities/MapChanger",function(t,e,n){var i,o,s,r=function(t,e){return function(){return t.apply(e,arguments)}},a={}.hasOwnProperty,l=function(t,e){function n(){this.constructor=t}for(var i in e)a.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};i=e("entities/Event"),s=Chaplin.mediator,n.exports=o=function(t){function e(t,n){this._changeMap=r(this._changeMap,this),e.__super__.constructor.call(this,t,n),this.addListener("touchBegin",this._changeMap)}return l(e,t),e.prototype._changeMap=function(t){var e,n,i;return e=t.arguments[0],"Player"===(i=e.GetUserData().ent.name)||"PlayerSkeleton"===i?(s.playWithSounds&&s.soundManager.stopAll(n={sounds:!0,backgroundSounds:!0}),s.nextLevel=this.levelToChangeTo,s.publish("changeLvl")):void 0},e}(i)}),require.register("entities/Mario",function(t,e,n){var i,o,s,r,a=function(t,e){return function(){return t.apply(e,arguments)}},l={}.hasOwnProperty,c=function(t,e){function n(){this.constructor=t}for(var i in e)l.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};i=e("core/Entity"),s=e("components/Visual"),r=Chaplin.mediator,n.exports=o=function(t){function e(t,n){this.update=a(this.update,this);var i;n.properties.physicsType="static",e.__super__.constructor.call(this,t,n),this.visual=i=new s(this),function(t){return t.atlas.src="gameassets/atlases/mario.png",t.spriteState.viewDirection=2,t.tileSet.tilesX=3,t.tileSet.tilesY=4,t.tileSet.tileheight=32,t.tileSet.tilewidth=32,t.tileSet.offset={x:14,y:24}}(i)}return c(e,t),e.prototype.update=function(){return e.__super__.update.apply(this,arguments)},e}(i)}),require.register("entities/Player",function(t,e,n){var i,o,s,r,a=function(t,e){return function(){return t.apply(e,arguments)}},l={}.hasOwnProperty,c=function(t,e){function n(){this.constructor=t}for(var i in e)l.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};i=e("core/Entity"),s=e("components/Visual"),r=Chaplin.mediator,n.exports=o=function(t){function e(t,n){this.update=a(this.update,this),this.onAction=a(this.onAction,this),this.onTouchEnd=a(this.onTouchEnd,this),this.onTouchBegin=a(this.onTouchBegin,this),this.onTouch=a(this.onTouch,this);var i,o;n.properties.ellipse=!0,o=n.width,i=n.height,n.width=o/2,n.height=i/2,e.__super__.constructor.call(this,t,n),this.visual=new s(this),this.size.x=o,this.size.y=i}return c(e,t),e.prototype.onTouch=function(t){var e;return null==this.physBody?!1:null==t.GetUserData()?!1:(e=t.GetUserData().ent,(null!=e?e.killed:void 0)?!1:void 0)},e.prototype.onTouchBegin=function(t){var e;return this.touchingEntity=null!=(e=t.GetUserData())?e.ent:void 0,console.debug("Begin touching %O",this.touchingEntity)},e.prototype.onTouchEnd=function(){return console.debug("End touching %O",this.touchingEntity),this.touchingEntity=null},e.prototype.onAction=function(){var t;return null!=(t=this.touchingEntity)?t.onAction(this):void 0},e.prototype.update=function(){return e.__super__.update.apply(this,arguments)},e.prototype.onPositionChange=function(){return r.soundManager.updateBackgroundSounds(this.position)},e}(i)}),require.register("entities/Yeti",function(t,e,n){var i,o,s,r,a,l,c=function(t,e){return function(){return t.apply(e,arguments)}},u={}.hasOwnProperty,h=function(t,e){function n(){this.constructor=t}for(var i in e)u.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};i=e("core/Entity"),r=e("components/Visual"),o=e("components/Movable"),s=e("components/Scriptable"),l=Chaplin.mediator,n.exports=a=function(t){function e(t,n){this.onAction=c(this.onAction,this),this.update=c(this.update,this),this.onTouchEnd=c(this.onTouchEnd,this),this.onTouch=c(this.onTouch,this),this.onTouchBegin=c(this.onTouchBegin,this);var i,a;n.ellipse=!0,a=n.width,i=n.height,n.width=a/2,n.height=i/2,e.__super__.constructor.call(this,t,n),this.scriptable=new s(this),this.visual=new r(this),this.movable=new o(this),this.movable.mount(),this.scriptable.mount(),this.visual.spriteState.viewDirection=2,this.size.x=a,this.size.y=i}return h(e,t),e.prototype.onTouchBegin=function(t){var e;return this.visual.spriteState.moving=!0,"Player"===(null!=(e=t.GetUserData())?e.ent.name:void 0)?this.makeMeStatic():void 0},e.prototype.onTouch=function(){},e.prototype.onTouchEnd=function(t){var e;return this.visual.spriteState.moving=!1,"Player"===(null!=(e=t.GetUserData())?e.ent.name:void 0)?this.makeMeDynamic():void 0},e.prototype.update=function(){return e.__super__.update.apply(this,arguments)},e.prototype.onAction=function(){return l.dialogManager.showDialog({text:"PIKACHU!!!",options:["Yeah...right."]})},e}(i)}),require.register("entities/entities",function(t,e,n){n.exports={Event:e("entities/Event"),Gumba:e("entities/Gumba"),MapChanger:e("entities/MapChanger"),Mario:e("entities/Mario"),Player:e("entities/Player"),Yeti:e("entities/Yeti"),Level1Prolog:e("entities/Level1Prolog"),Level1NickTalking:e("entities/Level1NickTalking"),Level1Event1:e("entities/Level1Event1")}}),require.register("entities/home",function(t,e,n){var i,o,s,r={}.hasOwnProperty,a=function(t,e){function n(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=e("models/base/model"),n.exports=i=function(t){function e(){return s=e.__super__.constructor.apply(this,arguments)}return a(e,t),e}(o)}),require.register("initialize",function(t,e){var n,i;n=e("application"),i=e("routes"),$(function(){return new n({title:"Nick Skeleton",controllerSuffix:"-controller",routes:i})})}),require.register("lib/support",function(t,e,n){var i,o,s;i=e("chaplin"),s=e("lib/utils"),o=s.beget(i.support),n.exports=o}),require.register("lib/utils",function(t,e,n){var i,o;i=e("chaplin"),o=i.utils.beget(i.utils),n.exports=o}),require.register("lib/view-helper",function(){var t,e=[].slice;t=Chaplin.mediator,Handlebars.registerHelper("with",function(t,e){return!t||Handlebars.Utils.isEmpty(t)?e.inverse(this):e.fn(t)}),Handlebars.registerHelper("without",function(t,e){var n;return n=e.inverse,e.inverse=e.fn,e.fn=n,Handlebars.helpers["with"].call(this,t,e)}),Handlebars.registerHelper("url",function(){var n,i,o;return i=arguments[0],n=arguments.length>=2?e.call(arguments,1):[],o=null,t.publish("!router:reverse",i,n,function(t){return o=t}),"/"+o})}),require.register("models/base/model",function(t,e,n){var i,o,s={}.hasOwnProperty,r=function(t,e){function n(){this.constructor=t}for(var i in e)s.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n.exports=i=function(t){function e(){return o=e.__super__.constructor.apply(this,arguments)}return r(e,t),e}(Chaplin.Model)}),require.register("routes",function(t,e,n){n.exports=function(t){return t("","home#index"),t("index.html","home#index"),t("u/6045251/shiny-wight/index.html","home#index"),t("shiny-wight/index.html","home#index")}}),require.register("story/level1",function(t,e,n){n.exports={1:{speaker:"JT",text:"Yo, Snowsome, pathetic human spotted, Yo!"},2:{speaker:"Snowsome",text:"Measly little you.",options:"Run!"},3:{speaker:"JT",text:"Nice bro, you got Him",options:"What the..."},4:{speaker:"JT",text:"Nice skin, yo.",options:"Uhm... Yeah. Thanks, I guess?"},5:{speaker:"JT",text:"Give it to us",options:"Well..."},6:{speaker:"Snowsome",text:"Yeah, give it to us.",options:"Well... I would prefer not to..."},7:{speaker:"Nick Skeleton",text:"Seriously? Skin-Robbery? Yetis? I hate those days...",options:""},8:{speaker:"",text:"Once upon a time, all in the golden afternoon, fully leisurely our hero took a walk. The birds they sing, the fire cracks, what a wonderful day. But slowly one by one, its quaint events were hammered out and now the tale is done. Gee. I heard that before...",options:""},9:{speaker:"Nick Human",text:"What a wonderful day. Thus lovely noises, and hey; they get louder when I get closer to  them. God is such a genius."}}}),require.register("views/base/collection-view",function(t,e,n){var i,o,s,r,a={}.hasOwnProperty,l=function(t,e){function n(){this.constructor=t}for(var i in e)a.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};i=e("chaplin"),s=e("views/base/view"),n.exports=o=function(t){function e(){return r=e.__super__.constructor.apply(this,arguments)}return l(e,t),e.prototype.getTemplateFunction=s.prototype.getTemplateFunction,e}(i.CollectionView)}),require.register("views/base/view",function(t,e,n){var i,o,s={}.hasOwnProperty,r=function(t,e){function n(){this.constructor=t}for(var i in e)s.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};e("lib/view-helper"),n.exports=i=function(t){function e(){return o=e.__super__.constructor.apply(this,arguments)}return r(e,t),e.prototype.getTemplateFunction=function(){return this.template},e}(Chaplin.View)}),require.register("views/home-page-view",function(t,e,n){var i,o,s,r,a,l,c,u,h,p,m,f,d=function(t,e){return function(){return t.apply(e,arguments)}},y={}.hasOwnProperty,g=function(t,e){function n(){this.constructor=t}for(var i in e)y.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};p=e("views/base/view"),s=e("core/InputManager"),c=e("core/SoundManager"),i=e("core/DialogManager"),m=Chaplin.mediator,u=e("core/std"),r=e("core/Level"),h=Box2D.Common.Math.b2Vec2,a=1e3/60,l=40,n.exports=o=function(t){function e(){return this.draw=d(this.draw,this),this._handleAction=d(this._handleAction,this),this.handleInput=d(this.handleInput,this),this.doTheWork=d(this.doTheWork,this),this.setup=d(this.setup,this),this.loadNextLevels=d(this.loadNextLevels,this),this.loadLevel=d(this.loadLevel,this),f=e.__super__.constructor.apply(this,arguments)}return g(e,t),e.prototype.autoRender=!0,e.prototype.className="home-page",e.prototype.container="#page-container",e.prototype.initialize=function(){var t,n,o=this;return e.__super__.initialize.apply(this,arguments),debug&&this.setupDatGui(),new u,m.homepageview=this,this.handleAction=_.debounce(this._handleAction,50,!0),this.canvas=document.getElementById("game-canvas"),this.ctx=this.canvas.getContext("2d"),debug&&(window.mediator=m),m.playWithSounds&&(this.soundManager=new c),this.inputManager=new s,this.dialogManager=new i,n=Date.now(),this.lastPhysicsUpdate=n,this.lastRenderUpdate=n,this.subscribeEvent("changeLvl",function(){return console.debug("change to %s",m.nextLevel),o.setup(m.nextLevel)}),t="level1",this.loadLevel(t,function(){return o.setup(t),window.requestAnimationFrame(o.doTheWork)})},e.prototype.loadLevel=function(t,e){return null!=m.levels[t]?("function"==typeof e&&e(),void 0):m.levels[t]=new r(t,function(){return"function"==typeof e?e():void 0})},e.prototype.loadNextLevels=function(){var t,e,n,i,o;for(i=m.getActiveLevel().entityObjects,o=[],e=0,n=i.length;n>e;e++)t=i[e],null!=t.levelToChangeTo&&o.push(this.loadLevel(t.levelToChangeTo));return o},e.prototype.setup=function(t){var e,n=this;return e=m.levels[t],e.loadCompleted?(m.dialogManager.hideDialog(),m.activeLevel=t,e.setupped||e.setup(),m.playWithSounds&&this.soundManager.startAll(),this.loadNextLevels()):(m.dialogManager.isDialog()||m.dialogManager.showDialog({text:"Sorry, I still need to load some damn cool sound, so please hang in there!"}),setTimeout(function(){return n.setup(t)},500))},e.prototype.doTheWork=function(){var t,e,n,i;if(window.requestAnimationFrame(this.doTheWork),n=Date.now(),t=m.getActiveLevel(),null!=t){for(;n>this.lastPhysicsUpdate;)n-this.lastPhysicsUpdate>1e3?this.lastPhysicsUpdate=n:(this.handleInput(),t.updatePhysics(),t.update(),this.lastPhysicsUpdate+=a);return e=n-this.lastRenderUpdate-l,e>0&&(this.draw(),m.renderDebug&&t.physicsManager.world.DrawDebugData(),this.lastRenderUpdate=n),debug&&(i=Date.now()-n,i>40)?console.warn("Took %d ms to render frame.",i):void 0}},e.prototype.handleInput=function(){var t,e,n,i,o;return t=this.inputManager.get("actions"),e=new h(0,0),i=null!=(o=m.getActiveLevel())?o.player:void 0,null!=i?(t["move-up"]&&(e.y-=1,i.visual.spriteState.viewDirection=0,m.dialogManager.isDialog()&&m.dialogManager.moveSelectionUp()),t["move-down"]&&(e.y+=1,i.visual.spriteState.viewDirection=2,m.dialogManager.isDialog()&&m.dialogManager.moveSelectionDown()),t["move-left"]&&(e.x-=1,i.visual.spriteState.viewDirection=3),t["move-right"]&&(e.x+=1,i.visual.spriteState.viewDirection=1),t.interact&&this.handleAction(),t.cancel&&(n=!0),e.LengthSquared()&&!m.blockInput?(e.Normalize(),e.Multiply(i.velocity),i.physBody.SetLinearVelocity(e),m.playWithSounds&&i.onPositionChange(),i.visual.spriteState.moving=!0):(i.physBody.SetLinearVelocity(new h(0,0)),i.visual.spriteState.moving=!1)):void 0},e.prototype._handleAction=function(){var t;return m.dialogManager.isDialog()?m.dialogManager.chooseCurrentSelection():(t=m.getActiveLevel().player,t.onAction())},e.prototype.draw=function(){var t,e,n,i,o,s,r,a,l,c,u,h,p,f,d,y,_,g,v;for(s=m.getActiveLevel(),r=s.mapTiledObject.width,a=s.mapTiledObject.height,y={x:s.mapTiledObject.tileheight,y:s.mapTiledObject.tilewidth},l={x:r*y.x,y:a*y.y},c=s.player.position,u=6*y.x,f=c.x-u,d=c.y-u,p=e=h=t=2*u+y.x,n=0,i=0,f+p>l.x&&(f=l.x-p),d+h>l.y&&(d=l.y-h),0>f&&(f=0),0>d&&(d=0),p-f>l.x&&(p=e=l.x),h-d>l.y&&(h=t=l.y),this.canvas.width=p,this.canvas.height=h,this.ctx.drawImage(s.mapCanvas,f,d,p,h,n,i,e,t),v=s.entityObjects,_=0,g=v.length;g>_;_++)o=v[_],null!=o.visual&&o.visual.render(this.ctx,f,d);return s.player.visual.render(this.ctx,f,d)},e.prototype.setupDatGui=function(){var t,e,n,i,o,s;return i=new dat.GUI,i.remember(m),t=i.add({activeLevel:""},"activeLevel"),o=i.add(m,"playWithSounds"),e=i.add(m,"blockInput"),s=i.add(m,"renderDebug"),n=i.add(m,"disableDialogs"),t.listen(),o.listen(),e.listen(),s.listen(),n.listen(),t.onFinishChange(function(t){var e;return m.playWithSounds&&m.soundManager.stopAll(e={themeSound:!0,backgroundSounds:!0,sounds:!0}),m.homepageview.loadLevel(t,function(){return m.homepageview.setup(t)})})},e}(p)});